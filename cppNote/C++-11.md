# lambda表达式

C++11引入了lambda表达式作为一项新特性，为C++语言添加了一种更方便的定义匿名函数的方式。Lambda表达式允许**在需要使用函数对象（函数作为参数，例如在STL算法中）的地方直接定义函数，而无需显式地编写函数体或声明一个命名函数。**

1. **基本语法：**

   ```cpp
   [capture](parameters) -> return_type {
       // Lambda body
   }
   ```

   - `capture`: 用于捕获外部变量，可以是空，表示不捕获任何变量，也可以是`&`或`=`，分别表示引用捕获和复制捕获。
      + 引用捕获可以修改外部变量的值。
      + 复制捕获外部变量仅有可读权限，若要作出修改要使用关键字`multable`，但也仅仅在`lambda`函数体内有效，外部变量不会发生改变。
   - `parameters`: Lambda函数的参数列表，与普通函数一样。
   - `return_type`: 返回类型，**可以省略**，编译器可以自动推导。

2. **示例：**

   ```cpp
   // Lambda表达式示例
   auto add = [](int a, int b) -> int {
       return a + b;
   };
   cout << add(3, 4); // 输出 7
   ```

3. **捕获变量：**

   - `[&]`: 引用捕获，可以修改外部作用域的变量。
   - `[=]`: 复制捕获，以值的方式使用外部作用域的变量。
   - `[x, &y]`: 混合捕获，`x`通过值捕获，`y`通过引用捕获。

   + 如果仅用`[&]`表示引用捕获范围内所有的变量，`[=]`也是同理。

   + ```cpp
      //Capture Clause
      [&N, M]	//复制捕获M，其余引用捕获
      [M, &N]
      [&, =M]
      [=, &N]
      ```



4. **自动类型推导：** Lambda表达式支持自动类型推导，无需显式指定返回类型，编译器可以根据返回语句自动推导返回类型。

5. **可变lambda：** 使用`mutable`关键字允许在lambda内修改通过复制捕获的变量。

   ```cpp
   int x = 5;
   auto lambda = [x]() mutable {
       x += 2;
       cout << x << endl;
   };
   lambda(); // 输出 7
   cout << x << endl; // 输出 5
   
   
   
   int x = 5;
   auto lambda = [&x]() mutable {
       x += 2;
       cout << x << endl;
   };
   lambda(); // 输出 7
   cout << x << endl; // 输出 7
   ```

6. **Lambda作为参数：** Lambda表达式可以直接作为函数或算法的参数，提供一种更方便的方式来定义简短的函数功能。

   ```cpp
   vector<int> nums = {1, 2, 3, 4, 5};
   for_each(nums.begin(), nums.end(), [](int x) {
       cout << x << " ";
   });
   // 输出：1 2 3 4 5
   ```

7. 在`class`内亦可使用`lambda`函数传递函数功能

```cpp
#include <iostream>

class Person {
	public:
		Person(int age) : age(age) {}

		void printAge() {
			// 在类中使用匿名函数，通过this指针捕获对象
			auto lambda = [this]() {
				// 可以访问类的成员变量
				std::cout << "Current age of object: " << age << std::endl;
			};

			// 调用匿名函数
			lambda();
		}

	private:
		int age;
};

int main() {
	Person xiaoming(42);
	xiaoming.printAge();

	return 0;
}
```

+ `C++17`之后可以使用`*this`复制捕获对象

8. `C++14`之后可在`lambda`表达式的捕获列表内定义并初始化新的变量

```cpp
#include <iostream>
using namespace std;
int main() {

	int x = 100;
	int y = 200;

	auto func = [&x, &y, z = 300]() -> void {
		cout << x + y + z << endl;
	};
	func();

	return 0;
}
```

除此之外，`C++14`还引入了参数列表支持`auto`类型

```cpp
#include <iostream>
using namespace std;
int main() {

	auto f = [](auto a, auto b) {
		cout << a + b << endl;
	};

	f(5, 6); //11
	f(6.6, 8.8); //15.4
	return 0;
}
```



